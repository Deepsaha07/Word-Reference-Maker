<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WordRef</title>

  <link rel="stylesheet" href="./taskpane.css" />
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <!-- bundler injects taskpane.js; keep this if your setup requires manual include -->
  <!-- <script defer src="./taskpane.js"></script> -->
</head>

<body>
  <!-- Header -->
  <div class="app-header">
    <h2 class="app-title">WordRef</h2>
    <div class="help-wrap">
      <button id="helpIcon" class="help-icon" title="Instructions">i</button>
      <span id="helpText" class="help-text">Instructions</span>
    </div>
  </div>

  <!-- Instructions modal -->
  <div id="instructionsModal" class="backdrop" role="dialog" aria-modal="true" aria-labelledby="instTitle">
    <div class="modal">
      <div class="modal-header">
        <div id="instTitle" class="modal-title">How to use WordRef</div>
        <button id="closeInstructions" class="modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <ol>
          <li>Search your paper on <strong>Google Scholar</strong>.</li>
          <li>Click <em>Cite</em>, then choose <em>BibTeX</em>.</li>
          <li>Paste the BibTeX below and click <strong>Add</strong> (or <strong>Add &amp; Cite</strong>).</li>
          <li>Re-use items via the <strong>Cite</strong> button in results.</li>
          <li>Change citation style anytime; in-text &amp; bibliography update.</li>
          <li>Format the bibliography (font, size, spacing, alignment, color) below.</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Main pane -->
  <div class="pane">
    <textarea id="bibtexInput" placeholder="Paste BibTeX entry here…"></textarea>

    <div id="noteInputs">
      <input id="notePage" placeholder="Page / para / line"/>
      <input id="noteText" placeholder="Your note (optional)"/>
    </div>

    <div id="controlsRow">
      <button id="btnAddOnly">Add</button>
      <button id="btnAddCite">Add &amp; Cite</button>

      <select id="styleSelect" aria-label="Citation style">
        <option value="apa">APA</option>
        <option value="ieee">IEEE</option>
        <option value="harvard">Harvard</option>
        <option value="acs">American Chemical Society</option>
        <option value="vancouver">Vancouver</option>
      </select>
    </div>

    <div class="row" id="styleBadgeRow">
      <span id="styleBadge" class="badge">APA</span>
    </div>

    <input id="search" placeholder="Search author, year, title…"/>
    <div id="results"></div>

    <hr/>

    <!-- Row 1: general actions -->
    <div class="action-row">
      <button id="btnResetNumbering" title="Forget first-cited order only">Reset numbering</button>
      <button id="btnClearLibrary" title="Delete all saved entries">Clear Library</button>
      <button id="btnReload" title="Reload task pane UI">Reload</button>
    </div>

    <!-- Row 2: merge / unmerge (secondary style) -->
    <div class="action-row-secondary">
      <button id="btnMergeSelected" class="btn-outline" title="Merge selected citations">
        Merge citations
      </button>
      <button id="btnUnmergeSelected" class="btn-outline" title="Unmerge group citation">
        Unmerge citations
      </button>
    </div>

    <!-- Single accent button: update bibliography -->
    <div class="single-action-row">
      <button id="btnUpdateBib" class="btn-accent">
        Update bibliography
      </button>
    </div>

    <!-- Bibliography Format -->
    <section id="bibFormat">
      <div class="section-title">Bibliography Format</div>
      <div id="bibFormatRow">
        <div class="form-chunk">
          <label for="bibFont">Font:</label>
          <select id="bibFont">
            <option value="Times New Roman" selected>Times New Roman</option>
            <option value="Calibri">Calibri</option>
            <option value="Arial">Arial</option>
            <option value="Cambria">Cambria</option>
          </select>
        </div>
        <div class="form-chunk">
          <label for="bibSize">Size:</label>
          <input id="bibSize" type="number" value="12" min="8" max="24" style="width:4.5em;">
        </div>
        <div class="form-chunk">
          <label for="bibSpacing">Line spacing:</label>
          <input id="bibSpacing" type="number" value="14" min="10" max="36" style="width:4.5em;">
        </div>
        <div class="form-chunk">
          <label for="bibAlign">Alignment:</label>
          <select id="bibAlign">
            <option value="Left" selected>Left</option>
            <option value="Justified">Justified</option>
            <option value="Centered">Centered</option>
            <option value="Right">Right</option>
          </select>
        </div>
        <div class="form-chunk">
          <label for="bibColor">Font color:</label>
          <input id="bibColor" class="swatch" type="color" value="#333333" />
        </div>
      </div>
    </section>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" aria-live="polite"></div>

  <!-- Inline confirm -->
  <div id="confirmBar" class="confirm-bar" style="display:none">
    <span id="confirmMsg"></span>
    <button id="confirmYes">Yes</button>
    <button id="confirmNo">Cancel</button>
  </div>

  <!-- Toolbar buttons (Create / Import library) -->
  <div class="footer-actions">
    <button id="btnOpenLibPanel">Create library</button>
    <button id="btnOpenImportPanel">Import library</button>
  </div>

  <!-- Cited Library panel (read-only, copy-friendly) -->
  <div id="citedLibPanel" class="sheet hidden">
    <div class="sheet-head">
      <div class="sheet-title">Cited BibTeX</div>
      <div class="sheet-actions">
        <button id="btnCitedRefresh">Refresh</button>
        <button id="btnCitedCopy">Copy</button>
        <button id="btnCitedClose">Close</button>
      </div>
    </div>
    <textarea id="citedBibtexBox" readonly spellcheck="false"></textarea>
    <div class="hint">
      This is generated from the citations in your document. Click <b>Copy</b> to use elsewhere.
    </div>
  </div>

  <!-- Import Library panel (paste BibTeX, then parse & add) -->
  <div id="importModal" class="modal-wrap hidden">
    <div class="modal-backdrop" id="importBackdrop"></div>

    <div class="modal-card">
      <div class="sheet-head">
        <div class="sheet-title">Import BibTeX</div>
        <div class="sheet-actions">
          <button id="btnImportParse">Parse &amp; Add</button>
          <button id="btnImportClose">Cancel</button>
        </div>
      </div>
      <textarea id="importBibtexBox" placeholder="@article{...}\n@inproceedings{...}"></textarea>
      <div class="hint">Paste one or more BibTeX entries. Duplicates are skipped.</div>
    </div>
  </div>

  <!-- ===== Dialog mode (when opened as #download-dialog) ===== -->
</body>
</html>